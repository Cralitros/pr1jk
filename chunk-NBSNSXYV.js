import{a as m}from"./chunk-VJ2UBCPQ.js";import{a as D,d as M,t as O}from"./chunk-K5XGN6PE.js";import{h as E}from"./chunk-2NVXBLI6.js";import{a as g,b as P}from"./chunk-P43J7MUA.js";import{a as x}from"./chunk-ZJDAKJRA.js";import{d as R}from"./chunk-RTO4VP25.js";import{a as _}from"./chunk-L3UYHT7M.js";function $(t){t.indexOf("vClipPlane")===-1&&t.push("vClipPlane"),t.indexOf("vClipPlane2")===-1&&t.push("vClipPlane2"),t.indexOf("vClipPlane3")===-1&&t.push("vClipPlane3"),t.indexOf("vClipPlane4")===-1&&t.push("vClipPlane4"),t.indexOf("vClipPlane5")===-1&&t.push("vClipPlane5"),t.indexOf("vClipPlane6")===-1&&t.push("vClipPlane6")}function ee(t,e,r){let a=!!(t.clipPlane??e.clipPlane),o=!!(t.clipPlane2??e.clipPlane2),n=!!(t.clipPlane3??e.clipPlane3),i=!!(t.clipPlane4??e.clipPlane4),s=!!(t.clipPlane5??e.clipPlane5),u=!!(t.clipPlane6??e.clipPlane6);a&&r.push("#define CLIPPLANE"),o&&r.push("#define CLIPPLANE2"),n&&r.push("#define CLIPPLANE3"),i&&r.push("#define CLIPPLANE4"),s&&r.push("#define CLIPPLANE5"),u&&r.push("#define CLIPPLANE6")}function h(t,e,r){let a=!1,o=!!(t.clipPlane??e.clipPlane),n=!!(t.clipPlane2??e.clipPlane2),i=!!(t.clipPlane3??e.clipPlane3),s=!!(t.clipPlane4??e.clipPlane4),u=!!(t.clipPlane5??e.clipPlane5),l=!!(t.clipPlane6??e.clipPlane6);return r.CLIPPLANE!==o&&(r.CLIPPLANE=o,a=!0),r.CLIPPLANE2!==n&&(r.CLIPPLANE2=n,a=!0),r.CLIPPLANE3!==i&&(r.CLIPPLANE3=i,a=!0),r.CLIPPLANE4!==s&&(r.CLIPPLANE4=s,a=!0),r.CLIPPLANE5!==u&&(r.CLIPPLANE5=u,a=!0),r.CLIPPLANE6!==l&&(r.CLIPPLANE6=l,a=!0),a}function te(t,e,r){let a=e.clipPlane??r.clipPlane;f(t,"vClipPlane",a),a=e.clipPlane2??r.clipPlane2,f(t,"vClipPlane2",a),a=e.clipPlane3??r.clipPlane3,f(t,"vClipPlane3",a),a=e.clipPlane4??r.clipPlane4,f(t,"vClipPlane4",a),a=e.clipPlane5??r.clipPlane5,f(t,"vClipPlane5",a),a=e.clipPlane6??r.clipPlane6,f(t,"vClipPlane6",a)}function f(t,e,r){r&&t.setFloat4(e,r.normal.x,r.normal.y,r.normal.z,r.d)}var F=D.Black(),U={NUM_MORPH_INFLUENCERS:0};function se(t,e,r){if(!t||t.LOGARITHMICDEPTH||t.indexOf&&t.indexOf("LOGARITHMICDEPTH")>=0){let a=r.activeCamera;a.mode===1&&x.Error("Logarithmic depth is not compatible with orthographic cameras!",20),e.setFloat("logarithmicDepthConstant",2/(Math.log(a.maxZ+1)/Math.LN2))}}function ue(t,e,r,a=!1){r&&t.fogEnabled&&(!e||e.applyFog)&&t.fogMode!==0&&(r.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),a?(t.fogColor.toLinearSpaceToRef(F,t.getEngine().useExactSrgbConversions),r.setColor3("vFogColor",F)):r.setColor3("vFogColor",t.fogColor))}function pe(t,e,r){U.NUM_MORPH_INFLUENCERS=r,v(t,e,U)}function v(t,e,r){let a=r.NUM_MORPH_INFLUENCERS;if(a>0&&R.LastCreatedEngine){let o=R.LastCreatedEngine.getCaps().maxVertexAttribs,n=e.morphTargetManager;if(n?.isUsingTextureForTargets)return;let i=n&&n.supportsNormals&&r.NORMAL,s=n&&n.supportsTangents&&r.TANGENT,u=n&&n.supportsUVs&&r.UV1;for(let l=0;l<a;l++)t.push("position"+l),i&&t.push("normal"+l),s&&t.push("tangent"+l),u&&t.push("uv_"+l),t.length>o&&x.Error("Cannot add more vertex attributes for mesh "+e.name)}}function W(t,e=!1){t.push("world0"),t.push("world1"),t.push("world2"),t.push("world3"),e&&(t.push("previousWorld0"),t.push("previousWorld1"),t.push("previousWorld2"),t.push("previousWorld3"))}function V(t,e){let r=t.morphTargetManager;!t||!r||e.setFloatArray("morphTargetInfluences",r.influences)}function ce(t,e){e.bindToEffect(t,"Scene")}function Ee(t,e,r){e._needUVs=!0,e[r]=!0,t.optimizeUVAllocation&&t.getTextureMatrix().isIdentityAs3x2()?(e[r+"DIRECTUV"]=t.coordinatesIndex+1,e["MAINUV"+(t.coordinatesIndex+1)]=!0):e[r+"DIRECTUV"]=0}function Ae(t,e,r){let a=t.getTextureMatrix();e.updateMatrix(r+"Matrix",a)}function H(t,e,r){r.BAKED_VERTEX_ANIMATION_TEXTURE&&r.INSTANCES&&t.push("bakedVertexAnimationSettingsInstanced")}function G(t,e){return e.set(t),e}function d(t,e,r){if(!(!e||!t)&&(t.computeBonesUsingShaders&&e._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){let a=t.skeleton;if(a.isUsingTextureForMatrices&&e.getUniformIndex("boneTextureWidth")>-1){let o=a.getTransformMatrixTexture(t);e.setTexture("boneSampler",o),e.setFloat("boneTextureWidth",4*(a.bones.length+1))}else{let o=a.getTransformMatrices(t);o&&(e.setMatrices("mBones",o),r&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(r.previousBones[t.uniqueId]||(r.previousBones[t.uniqueId]=o.slice()),e.setMatrices("mPreviousBones",r.previousBones[t.uniqueId]),G(o,r.previousBones[t.uniqueId])))}}}function k(t,e,r,a,o,n=!0){t._bindLight(e,r,a,o,n)}function Pe(t,e,r,a,o=4){let n=Math.min(e.lightSources.length,o);for(let i=0;i<n;i++){let s=e.lightSources[i];k(s,i,t,r,typeof a=="boolean"?a:a.SPECULARTERM,e.receiveShadows)}}function Se(t,e,r,a){r.NUM_BONE_INFLUENCERS>0&&(a.addCPUSkinningFallback(0,e),t.push("matricesIndices"),t.push("matricesWeights"),r.NUM_BONE_INFLUENCERS>4&&(t.push("matricesIndicesExtra"),t.push("matricesWeightsExtra")))}function Te(t,e){(e.INSTANCES||e.THIN_INSTANCES)&&W(t,!!e.PREPASS_VELOCITY),e.INSTANCESCOLOR&&t.push("instanceColor")}function me(t,e,r=4,a=0){let o=0;for(let n=0;n<r&&t["LIGHT"+n];n++)n>0&&(o=a+n,e.addFallback(o,"LIGHT"+n)),t.SHADOWS||(t["SHADOW"+n]&&e.addFallback(a,"SHADOW"+n),t["SHADOWPCF"+n]&&e.addFallback(a,"SHADOWPCF"+n),t["SHADOWPCSS"+n]&&e.addFallback(a,"SHADOWPCSS"+n),t["SHADOWPOISSON"+n]&&e.addFallback(a,"SHADOWPOISSON"+n),t["SHADOWESM"+n]&&e.addFallback(a,"SHADOWESM"+n),t["SHADOWCLOSEESM"+n]&&e.addFallback(a,"SHADOWCLOSEESM"+n));return o++}function X(t,e){return e.fogEnabled&&t.applyFog&&e.fogMode!==0}function fe(t,e,r,a,o,n,i,s=!1){i._areMiscDirty&&(i.LOGARITHMICDEPTH=r,i.POINTSIZE=a,i.FOG=o&&X(t,e),i.NONUNIFORMSCALING=t.nonUniformScaling,i.ALPHATEST=n,i.DECAL_AFTER_DETAIL=s)}function Ne(t,e,r,a,o=4,n=!1){if(!r._areLightsDirty)return r._needNormals;let i=0,s={needNormals:r._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(t.lightsEnabled&&!n){for(let l of e.lightSources)if(y(t,e,l,i,r,a,s),i++,i===o)break}r.SPECULARTERM=s.specularEnabled,r.SHADOWS=s.shadowEnabled;for(let l=i;l<o;l++)r["LIGHT"+l]!==void 0&&(r["LIGHT"+l]=!1,r["HEMILIGHT"+l]=!1,r["POINTLIGHT"+l]=!1,r["DIRLIGHT"+l]=!1,r["SPOTLIGHT"+l]=!1,r["SHADOW"+l]=!1,r["SHADOWCSM"+l]=!1,r["SHADOWCSMDEBUG"+l]=!1,r["SHADOWCSMNUM_CASCADES"+l]=!1,r["SHADOWCSMUSESHADOWMAXZ"+l]=!1,r["SHADOWCSMNOBLEND"+l]=!1,r["SHADOWCSM_RIGHTHANDED"+l]=!1,r["SHADOWPCF"+l]=!1,r["SHADOWPCSS"+l]=!1,r["SHADOWPOISSON"+l]=!1,r["SHADOWESM"+l]=!1,r["SHADOWCLOSEESM"+l]=!1,r["SHADOWCUBE"+l]=!1,r["SHADOWLOWQUALITY"+l]=!1,r["SHADOWMEDIUMQUALITY"+l]=!1);let u=t.getEngine().getCaps();return r.SHADOWFLOAT===void 0&&(s.needRebuild=!0),r.SHADOWFLOAT=s.shadowEnabled&&(u.textureFloatRender&&u.textureFloatLinearFiltering||u.textureHalfFloatRender&&u.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=s.lightmapMode,s.needRebuild&&r.rebuild(),s.needNormals}function y(t,e,r,a,o,n,i){switch(i.needNormals=!0,o["LIGHT"+a]===void 0&&(i.needRebuild=!0),o["LIGHT"+a]=!0,o["SPOTLIGHT"+a]=!1,o["HEMILIGHT"+a]=!1,o["POINTLIGHT"+a]=!1,o["DIRLIGHT"+a]=!1,r.prepareLightSpecificDefines(o,a),o["LIGHT_FALLOFF_PHYSICAL"+a]=!1,o["LIGHT_FALLOFF_GLTF"+a]=!1,o["LIGHT_FALLOFF_STANDARD"+a]=!1,r.falloffType){case m.FALLOFF_GLTF:o["LIGHT_FALLOFF_GLTF"+a]=!0;break;case m.FALLOFF_PHYSICAL:o["LIGHT_FALLOFF_PHYSICAL"+a]=!0;break;case m.FALLOFF_STANDARD:o["LIGHT_FALLOFF_STANDARD"+a]=!0;break}if(n&&!r.specular.equalsFloats(0,0,0)&&(i.specularEnabled=!0),o["SHADOW"+a]=!1,o["SHADOWCSM"+a]=!1,o["SHADOWCSMDEBUG"+a]=!1,o["SHADOWCSMNUM_CASCADES"+a]=!1,o["SHADOWCSMUSESHADOWMAXZ"+a]=!1,o["SHADOWCSMNOBLEND"+a]=!1,o["SHADOWCSM_RIGHTHANDED"+a]=!1,o["SHADOWPCF"+a]=!1,o["SHADOWPCSS"+a]=!1,o["SHADOWPOISSON"+a]=!1,o["SHADOWESM"+a]=!1,o["SHADOWCLOSEESM"+a]=!1,o["SHADOWCUBE"+a]=!1,o["SHADOWLOWQUALITY"+a]=!1,o["SHADOWMEDIUMQUALITY"+a]=!1,e&&e.receiveShadows&&t.shadowsEnabled&&r.shadowEnabled){let s=r.getShadowGenerator(t.activeCamera)??r.getShadowGenerator();if(s){let u=s.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(i.shadowEnabled=!0,s.prepareDefines(o,a))}}r.lightmapMode!=m.LIGHTMAP_DEFAULT?(i.lightmapMode=!0,o["LIGHTMAPEXCLUDED"+a]=!0,o["LIGHTMAPNOSPECULAR"+a]=r.lightmapMode==m.LIGHTMAP_SHADOWSONLY):(o["LIGHTMAPEXCLUDED"+a]=!1,o["LIGHTMAPNOSPECULAR"+a]=!1)}function Le(t,e,r,a,o,n=null,i=!1){let s=K(t,a);n!==!1&&(s=h(r,t,a)),a.DEPTHPREPASS!==!e.getColorWrite()&&(a.DEPTHPREPASS=!a.DEPTHPREPASS,s=!0),a.INSTANCES!==o&&(a.INSTANCES=o,s=!0),a.THIN_INSTANCES!==i&&(a.THIN_INSTANCES=i,s=!0),s&&a.markAsUnprocessed()}function w(t,e){if(t.useBones&&t.computeBonesUsingShaders&&t.skeleton){e.NUM_BONE_INFLUENCERS=t.numBoneInfluencers;let r=e.BONETEXTURE!==void 0;if(t.skeleton.isUsingTextureForMatrices&&r)e.BONETEXTURE=!0;else{e.BonesPerMesh=t.skeleton.bones.length+1,e.BONETEXTURE=r?!1:void 0;let a=t.getScene().prePassRenderer;if(a&&a.enabled){let o=a.excludedSkinnedMesh.indexOf(t)===-1;e.BONES_VELOCITY_ENABLED=o}}}else e.NUM_BONE_INFLUENCERS=0,e.BonesPerMesh=0,e.BONETEXTURE!==void 0&&(e.BONETEXTURE=!1)}function z(t,e){let r=t.morphTargetManager;r?(e.MORPHTARGETS_UV=r.supportsUVs&&e.UV1,e.MORPHTARGETS_TANGENT=r.supportsTangents&&e.TANGENT,e.MORPHTARGETS_NORMAL=r.supportsNormals&&e.NORMAL,e.NUM_MORPH_INFLUENCERS=r.numMaxInfluencers||r.numInfluencers,e.MORPHTARGETS=e.NUM_MORPH_INFLUENCERS>0,e.MORPHTARGETS_TEXTURE=r.isUsingTextureForTargets):(e.MORPHTARGETS_UV=!1,e.MORPHTARGETS_TANGENT=!1,e.MORPHTARGETS_NORMAL=!1,e.MORPHTARGETS=!1,e.NUM_MORPH_INFLUENCERS=0)}function Y(t,e){let r=t.bakedVertexAnimationManager;e.BAKED_VERTEX_ANIMATION_TEXTURE=!!(r&&r.isEnabled)}function _e(t,e,r,a,o=!1,n=!0,i=!0){if(!e._areAttributesDirty&&e._needNormals===e._normals&&e._needUVs===e._uvs)return!1;e._normals=e._needNormals,e._uvs=e._needUVs,e.NORMAL=e._needNormals&&t.isVerticesDataPresent("normal"),e._needNormals&&t.isVerticesDataPresent("tangent")&&(e.TANGENT=!0);for(let s=1;s<=6;++s)e["UV"+s]=e._needUVs?t.isVerticesDataPresent(`uv${s===1?"":s}`):!1;if(r){let s=t.useVertexColors&&t.isVerticesDataPresent("color");e.VERTEXCOLOR=s,e.VERTEXALPHA=t.hasVertexAlpha&&s&&n}return t.isVerticesDataPresent("instanceColor")&&(t.hasInstances||t.hasThinInstances)&&(e.INSTANCESCOLOR=!0),a&&w(t,e),o&&z(t,e),i&&Y(t,e),!0}function Ce(t,e){if(t.activeCamera){let r=e.MULTIVIEW;e.MULTIVIEW=t.activeCamera.outputRenderTarget!==null&&t.activeCamera.outputRenderTarget.getViewCount()>1,e.MULTIVIEW!=r&&e.markAsUnprocessed()}}function Re(t,e,r){let a=e.ORDER_INDEPENDENT_TRANSPARENCY,o=e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;e.ORDER_INDEPENDENT_TRANSPARENCY=t.useOrderIndependentTransparency&&r,e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!t.getEngine().getCaps().textureFloatLinearFiltering,(a!==e.ORDER_INDEPENDENT_TRANSPARENCY||o!==e.ORDER_INDEPENDENT_TRANSPARENCY_16BITS)&&e.markAsUnprocessed()}function xe(t,e,r){let a=e.PREPASS;if(!e._arePrePassDirty)return;let o=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(t.prePassRenderer&&t.prePassRenderer.enabled&&r){e.PREPASS=!0,e.SCENE_MRT_COUNT=t.prePassRenderer.mrtCount,e.PREPASS_NORMAL_WORLDSPACE=t.prePassRenderer.generateNormalsInWorldSpace,e.PREPASS_COLOR=!0,e.PREPASS_COLOR_INDEX=0;for(let n=0;n<o.length;n++){let i=t.prePassRenderer.getIndex(o[n].type);i!==-1?(e[o[n].define]=!0,e[o[n].index]=i):e[o[n].define]=!1}}else{e.PREPASS=!1;for(let n=0;n<o.length;n++)e[o[n].define]=!1}e.PREPASS!=a&&(e.markAsUnprocessed(),e.markAsImageProcessingDirty())}function K(t,e){let r=!1;if(t.activeCamera){let a=e.CAMERA_ORTHOGRAPHIC?1:0,o=e.CAMERA_PERSPECTIVE?1:0,n=t.activeCamera.mode===1?1:0,i=t.activeCamera.mode===0?1:0;(a^n||o^i)&&(e.CAMERA_ORTHOGRAPHIC=n===1,e.CAMERA_PERSPECTIVE=i===1,r=!0)}return r}function q(t,e,r,a,o=null,n=!1){o&&o.push("Light"+t),!n&&(e.push("vLightData"+t,"vLightDiffuse"+t,"vLightSpecular"+t,"vLightDirection"+t,"vLightFalloff"+t,"vLightGround"+t,"lightMatrix"+t,"shadowsInfo"+t,"depthValues"+t),r.push("shadowTexture"+t),r.push("depthTexture"+t),e.push("viewFrustumZ"+t,"cascadeBlendFactor"+t,"lightSizeUVCorrection"+t,"depthCorrection"+t,"penumbraDarkness"+t,"frustumLengths"+t),a&&(r.push("projectionLightTexture"+t),e.push("textureProjectionMatrix"+t)))}function Me(t,e,r,a=4){let o,n=null;if(t.uniformsNames){let i=t;o=i.uniformsNames,n=i.uniformBuffersNames,e=i.samplers,r=i.defines,a=i.maxSimultaneousLights||0}else o=t,e||(e=[]);for(let i=0;i<a&&r["LIGHT"+i];i++)q(i,o,e,r["PROJECTEDLIGHTTEXTURE"+i],n);r.NUM_MORPH_INFLUENCERS&&(o.push("morphTargetInfluences"),o.push("morphTargetCount")),r.BAKED_VERTEX_ANIMATION_TEXTURE&&(o.push("bakedVertexAnimationSettings"),o.push("bakedVertexAnimationTextureSizeInverted"),o.push("bakedVertexAnimationTime"),e.push("bakedVertexAnimationTexture"))}var N=class{static extractMinAndMaxIndexed(e,r,a,o,n,i){for(let s=a;s<a+o;s++){let u=r[s]*3,l=e[u],p=e[u+1],c=e[u+2];n.minimizeInPlaceFromFloats(l,p,c),i.maximizeInPlaceFromFloats(l,p,c)}}static extractMinAndMax(e,r,a,o,n,i){for(let s=r,u=r*o;s<r+a;s++,u+=o){let l=e[u],p=e[u+1],c=e[u+2];n.minimizeInPlaceFromFloats(l,p,c),i.maximizeInPlaceFromFloats(l,p,c)}}};M([O.filter((...[t,e])=>!Array.isArray(t)&&!Array.isArray(e))],N,"extractMinAndMaxIndexed",null);M([O.filter((...[t])=>!Array.isArray(t))],N,"extractMinAndMax",null);function he(t,e,r,a,o=null){let n=new E(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new E(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return N.extractMinAndMaxIndexed(t,e,r,a,n,i),o&&(n.x-=n.x*o.x+o.y,n.y-=n.y*o.x+o.y,n.z-=n.z*o.x+o.y,i.x+=i.x*o.x+o.y,i.y+=i.y*o.x+o.y,i.z+=i.z*o.x+o.y),{minimum:n,maximum:i}}function I(t,e,r,a=null,o){let n=new E(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new E(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return o||(o=3),N.extractMinAndMax(t,e,r,o,n,i),a&&(n.x-=n.x*a.x+a.y,n.y-=n.y*a.x+a.y,n.z-=n.z*a.x+a.y,i.x+=i.x*a.x+a.y,i.y+=i.y*a.x+a.y,i.z+=i.z*a.x+a.y),{minimum:n,maximum:i}}function Fe(t,e){let r=I(t,0,t.length/3),a=r.maximum.subtract(r.minimum).scale(.5).add(r.minimum),o=new E,n=new E,i=new E,s=new E,u=new E,l=new E,p=new E;for(let c=0;c<e.length;c+=3){let S=e[c],L=e[c+1],T=e[c+2];o.fromArray(t,S*3),n.fromArray(t,L*3),i.fromArray(t,T*3),n.subtractToRef(o,s),i.subtractToRef(o,u),E.CrossToRef(s,u,l),l.normalize();let A=o.x+n.x+i.x,b=o.y+n.y+i.y,B=o.z+n.z+i.z;p.set(A/3,b/3,B/3),p.subtractInPlace(a),p.normalize(),E.Dot(l,p)>=0&&(e[c]=T,e[c+2]=S)}}var Q="gpuTransformVertexShader",Z=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
out vec3 outPosition;const mat4 identity=mat4(
vec4(1.0,0.0,0.0,0.0),
vec4(0.0,1.0,0.0,0.0),
vec4(0.0,0.0,1.0,0.0),
vec4(0.0,0.0,0.0,1.0)
);void main(void) {vec3 positionUpdated=position;
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
mat4 finalWorld=identity;
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);outPosition=worldPos.xyz;}`;_.ShadersStore[Q]=Z;var j="gpuTransformPixelShader",J=`#version 300 es
void main() {discard;}
`;_.ShadersStore[j]=J;var C=class t{constructor(e){this._buffers={},this._effects={},this._meshListCounter=0,this._engine=e}processAsync(e){return Array.isArray(e)||(e=[e]),this._meshListCounter=0,this._processMeshList(e),Promise.resolve()}_processMeshList(e){let r=this._engine.getCaps().parallelShaderCompile;this._engine.getCaps().parallelShaderCompile=void 0;for(let a=0;a<e.length;++a){let o=e[a];if(o.getTotalVertices()===0||!o.getVertexBuffer||!o.getVertexBuffer(P.PositionKind))continue;let i,s=0,u=[],l=[],p=[P.PositionKind],c=[];if(o&&o.useBones&&o.computeBonesUsingShaders&&o.skeleton){p.push(P.MatricesIndicesKind),p.push(P.MatricesWeightsKind),o.numBoneInfluencers>4&&(p.push(P.MatricesIndicesExtraKind),p.push(P.MatricesWeightsExtraKind));let A=o.skeleton;u.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),A.isUsingTextureForMatrices?(u.push("#define BONETEXTURE"),l.indexOf("boneTextureWidth")===-1&&l.push("boneTextureWidth"),c.indexOf("boneSampler")===-1&&c.push("boneSampler")):(u.push("#define BonesPerMesh "+(A.bones.length+1)),l.indexOf("mBones")===-1&&l.push("mBones"))}else u.push("#define NUM_BONE_INFLUENCERS 0");let S=o?o.morphTargetManager:null;if(S){s=S.numMaxInfluencers||S.numInfluencers,s>0&&u.push("#define MORPHTARGETS"),S.isUsingTextureForTargets&&(u.push("#define MORPHTARGETS_TEXTURE"),l.indexOf("morphTargetTextureIndices")===-1&&l.push("morphTargetTextureIndices"),c.indexOf("morphTargets")===-1&&c.push("morphTargets")),u.push("#define NUM_MORPH_INFLUENCERS "+s);for(let A=0;A<s;A++)p.push(P.PositionKind+A);s>0&&(l=l.slice(),l.push("morphTargetInfluences"),l.push("morphTargetCount"),l.push("morphTargetTextureInfo"),l.push("morphTargetTextureIndices"))}let L=o.bakedVertexAnimationManager;L&&L.isEnabled&&(u.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),l.indexOf("bakedVertexAnimationSettings")===-1&&l.push("bakedVertexAnimationSettings"),l.indexOf("bakedVertexAnimationTextureSizeInverted")===-1&&l.push("bakedVertexAnimationTextureSizeInverted"),l.indexOf("bakedVertexAnimationTime")===-1&&l.push("bakedVertexAnimationTime"),c.indexOf("bakedVertexAnimationTexture")===-1&&c.push("bakedVertexAnimationTexture"),H(p,o,u));let T=u.join(`
`);if(this._effects[T])i=this._effects[T];else{let A={attributes:p,uniformsNames:l,uniformBuffersNames:[],samplers:c,defines:T,fallbacks:null,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:s},maxSimultaneousLights:0,transformFeedbackVaryings:["outPosition"]};i=this._engine.createEffect("gpuTransform",A,this._engine),this._effects[T]=i}this._compute(o,i)}this._engine.getCaps().parallelShaderCompile=r}_compute(e,r){let a=this._engine,o,n=e.getTotalVertices();if(this._buffers[e.uniqueId])o=this._buffers[e.uniqueId];else{let l=new Float32Array(n*3);o=new g(e.getEngine(),l,!0,3),this._buffers[e.uniqueId]=o}r.getEngine().enableEffect(r),e._bindDirect(r,null,!0),d(e,r);let i=e.morphTargetManager;i&&i.numInfluencers>0&&V(e,r);let s=e.bakedVertexAnimationManager;s&&s.isEnabled&&e.bakedVertexAnimationManager?.bind(r,!1);let u=o.getData();if(a.bindTransformFeedbackBuffer(o.getBuffer()),a.setRasterizerState(!1),a.beginTransformFeedback(!0),a.drawArraysType(2,0,n),a.endTransformFeedback(),a.setRasterizerState(!0),a.readTransformFeedbackBuffer(u),a.bindTransformFeedbackBuffer(null),this._meshListCounter===0)e._refreshBoundingInfo(u,null);else{let l=e.getBoundingInfo().boundingBox,p=I(u,0,n);t._Min.copyFrom(l.minimum).minimizeInPlace(p.minimum),t._Max.copyFrom(l.maximum).maximizeInPlace(p.maximum),e._refreshBoundingInfoDirect({minimum:t._Min,maximum:t._Max})}}registerMeshListAsync(e){return Array.isArray(e)||(e=[e]),this._meshList=e,this._meshListCounter=0,Promise.resolve()}processMeshList(){this._meshList.length!==0&&(this._processMeshList(this._meshList),this._meshListCounter++)}fetchResultsForMeshListAsync(){return this._meshListCounter=0,Promise.resolve()}dispose(){for(let e in this._buffers)this._buffers[e].dispose();this._buffers={},this._effects={},this._engine=null}};C._Min=new E;C._Max=new E;export{he as a,I as b,Fe as c,$ as d,ee as e,te as f,se as g,ue as h,pe as i,v as j,W as k,V as l,ce as m,Ee as n,Ae as o,H as p,d as q,k as r,Pe as s,Se as t,Te as u,me as v,X as w,fe as x,Ne as y,y as z,Le as A,w as B,z as C,_e as D,Ce as E,Re as F,xe as G,K as H,q as I,Me as J,C as K};
