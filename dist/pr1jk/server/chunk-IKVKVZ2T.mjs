import './polyfills.server.mjs';
import{b as G}from"./chunk-JBXNSZOT.mjs";import{M as P,b as _,g as $,p as z}from"./chunk-3EP7245L.mjs";import{b as O,d as k}from"./chunk-E6UFF6GL.mjs";import{a as v}from"./chunk-QLEC6GUN.mjs";import{a as X}from"./chunk-AYA2QI3U.mjs";function ae(){return typeof _native<"u"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}var y=class e{constructor(){this._xhr=ae(),this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(e.CustomRequestHeaders).length>0||e.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(let r in e.CustomRequestHeaders){let t=e.CustomRequestHeaders[r];t&&this._xhr.setRequestHeader(r,t)}}_shouldSkipRequestModifications(r){return e.SkipRequestModificationForBabylonCDN&&(r.includes("preview.babylonjs.com")||r.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(r){this._xhr.onprogress=r}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(r){this._xhr.responseType=r}get timeout(){return this._xhr.timeout}set timeout(r){this._xhr.timeout=r}addEventListener(r,t,i){this._xhr.addEventListener(r,t,i)}removeEventListener(r,t,i){this._xhr.removeEventListener(r,t,i)}abort(){this._xhr.abort()}send(r){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(r)}open(r,t){for(let i of e.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;i(this._xhr,t)}t=t.replace("file:http:","http:"),t=t.replace("file:https:","https:"),this._requestURL=t,this._xhr.open(r,t,!0)}setRequestHeader(r,t){this._xhr.setRequestHeader(r,t)}getResponseHeader(r){return this._xhr.getResponseHeader(r)}};y.CustomRequestHeaders={};y.CustomRequestModifiers=new Array;y.SkipRequestModificationForBabylonCDN=!0;var T=class{static SetImmediate(r){_()&&window.setImmediate?window.setImmediate(r):setTimeout(r,1)}};function me(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)})}var be=(()=>{class e{static Instantiate(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];let i=G(t);if(i)return i;v.Warn(t+" not found, you may have missed an import.");let c=t.split("."),o=window||this;for(let u=0,a=c.length;u<a;u++)o=o[c[u]];return typeof o!="function"?null:o}}return e.RegisteredExternalClasses={},e})();var B=(()=>{class e{}return e.FilesToLoad={},e})();var I=class{static ExponentialBackoff(r=3,t=500){return(i,c,o)=>c.status!==0||o>=r||i.indexOf("file:")!==-1?-1:Math.pow(2,o)*t}};var R=class extends Error{};R._setPrototypeOf=Object.setPrototypeOf||((e,r)=>(e.__proto__=r,e));var H={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},U=class e extends R{constructor(r,t,i){super(r),this.errorCode=t,this.innerError=i,this.name="RuntimeError",R._setPrototypeOf(this,e.prototype)}};var V=e=>{let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",i,c,o,u,a,d,f,n=0,s=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);for(;n<s.length;)i=s[n++],c=n<s.length?s[n++]:Number.NaN,o=n<s.length?s[n++]:Number.NaN,u=i>>2,a=(i&3)<<4|c>>4,d=(c&15)<<2|o>>6,f=o&63,isNaN(c)?d=f=64:isNaN(o)&&(f=64),t+=r.charAt(u)+r.charAt(a)+r.charAt(d)+r.charAt(f);return t},A=e=>atob(e),J=e=>{let r=A(e),t=r.length,i=new Uint8Array(new ArrayBuffer(t));for(let c=0;c<t;c++)i[c]=r.charCodeAt(c);return i.buffer};var Q=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),D=class e extends U{constructor(r,t){super(r,H.LoadFileError),this.name="LoadFileError",R._setPrototypeOf(this,e.prototype),t instanceof y?this.request=t:this.file=t}},F=class e extends U{constructor(r,t){super(r,H.RequestFileError),this.request=t,this.name="RequestFileError",R._setPrototypeOf(this,e.prototype)}},N=class e extends U{constructor(r,t){super(r,H.ReadFileError),this.file=t,this.name="ReadFileError",R._setPrototypeOf(this,e.prototype)}},le=e=>(e=e.replace(/#/gm,"%23"),e),x={DefaultRetryStrategy:I.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:e=>e,ScriptBaseUrl:"",ScriptPreprocessUrl:e=>e,CleanUrl:le},Y=(e,r)=>{if(!(e&&e.indexOf("data:")===0)&&x.CorsBehavior)if(typeof x.CorsBehavior=="string"||x.CorsBehavior instanceof String)r.crossOrigin=x.CorsBehavior;else{let t=x.CorsBehavior(e);t&&(r.crossOrigin=t)}},K={getRequiredSize:null},Z=(e,r,t,i,c="",o)=>{let u=k.LastCreatedEngine;if(typeof HTMLImageElement>"u"&&!u?._features.forceBitmapOverHTMLImageElement)return t("LoadImage is only supported in web or BabylonNative environments."),null;let a,d=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?typeof Blob<"u"&&typeof URL<"u"?(a=URL.createObjectURL(new Blob([e],{type:c})),d=!0):a=`data:${c};base64,`+V(e):e instanceof Blob?(a=URL.createObjectURL(e),d=!0):(a=x.CleanUrl(e),a=x.PreprocessUrl(a));let f=l=>{if(t){let p=a||e.toString();t(`Error while trying to load image: ${p.indexOf("http")===0||p.length<=128?p:p.slice(0,128)+"..."}`,l)}};if(u?._features.forceBitmapOverHTMLImageElement)return E(a,l=>{u.createImageBitmap(new Blob([l],{type:c}),X({premultiplyAlpha:"none"},o)).then(p=>{r(p),d&&URL.revokeObjectURL(a)}).catch(p=>{t&&t("Error while trying to load image: "+e,p)})},void 0,i||void 0,!0,(l,p)=>{f(p)}),null;let n=new Image;if(K.getRequiredSize){let l=K.getRequiredSize(e);l.width&&(n.width=l.width),l.height&&(n.height=l.height)}Y(a,n);let s=[],m=()=>{s.forEach(l=>{l.target.addEventListener(l.name,l.handler)})},h=()=>{s.forEach(l=>{l.target.removeEventListener(l.name,l.handler)}),s.length=0},q=()=>{h(),r(n),d&&n.src&&URL.revokeObjectURL(n.src)},b=l=>{h(),f(l),d&&n.src&&URL.revokeObjectURL(n.src)},S=l=>{if(l.blockedURI!==n.src||l.disposition==="report")return;h();let p=new Error(`CSP violation of policy ${l.effectiveDirective} ${l.blockedURI}. Current policy is ${l.originalPolicy}`);k.UseFallbackTexture=!1,f(p),d&&n.src&&URL.revokeObjectURL(n.src),n.src=""};s.push({target:n,name:"load",handler:q}),s.push({target:n,name:"error",handler:b}),s.push({target:document,name:"securitypolicyviolation",handler:S}),m();let C=a.substring(0,5)==="blob:",L=a.substring(0,5)==="data:",g=()=>{C||L||!y.IsCustomRequestAvailable?n.src=a:E(a,(l,p,M)=>{let ne=!c&&M?M:c,oe=new Blob([l],{type:ne}),ie=URL.createObjectURL(oe);d=!0,n.src=ie},void 0,i||void 0,!0,(l,p)=>{f(p)})},j=()=>{i&&i.loadImage(a,n)};if(!C&&!L&&i&&i.enableTexturesOffline)i.open(j,g);else{if(a.indexOf("file:")!==-1){let l=decodeURIComponent(a.substring(5).toLowerCase());if(B.FilesToLoad[l]&&typeof URL<"u"){try{let p;try{p=URL.createObjectURL(B.FilesToLoad[l])}catch{p=URL.createObjectURL(B.FilesToLoad[l])}n.src=p,d=!0}catch{n.src=""}return n}}g()}return n},W=(e,r,t,i,c)=>{let o=new FileReader,u={onCompleteObservable:new O,abort:()=>o.abort()};return o.onloadend=()=>u.onCompleteObservable.notifyObservers(u),c&&(o.onerror=()=>{c(new N(`Unable to read ${e.name}`,e))}),o.onload=a=>{r(a.target.result)},t&&(o.onprogress=t),i?o.readAsArrayBuffer(e):o.readAsText(e),u},E=(e,r,t,i,c,o,u)=>{if(e.name)return W(e,r,t,c,o?n=>{o(void 0,n)}:void 0);let a=e;if(a.indexOf("file:")!==-1){let n=decodeURIComponent(a.substring(5).toLowerCase());n.indexOf("./")===0&&(n=n.substring(2));let s=B.FilesToLoad[n];if(s)return W(s,r,t,c,o?m=>o(void 0,new D(m.message,m.file)):void 0)}let{match:d,type:f}=ue(a);if(d){let n={onCompleteObservable:new O,abort:()=>()=>{}};try{let s=c?re(a):se(a);r(s,void 0,f)}catch(s){o?o(void 0,s):v.Error(s.message||"Failed to parse the Data URL")}return T.SetImmediate(()=>{n.onCompleteObservable.notifyObservers(n)}),n}return ee(a,(n,s)=>{r(n,s?.responseURL,s?.getResponseHeader("content-type"))},t,i,c,o?n=>{o(n.request,new D(n.message,n.request))}:void 0,u)},ee=(e,r,t,i,c,o,u)=>{e=x.CleanUrl(e),e=x.PreprocessUrl(e);let a=x.BaseUrl+e,d=!1,f={onCompleteObservable:new O,abort:()=>d=!0},n=()=>{let s=new y,m=null,h,q=()=>{s&&(t&&s.removeEventListener("progress",t),h&&s.removeEventListener("readystatechange",h),s.removeEventListener("loadend",b))},b=()=>{q(),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear(),t=void 0,h=null,b=null,o=void 0,u=void 0,r=void 0};f.abort=()=>{d=!0,b&&b(),s&&s.readyState!==(XMLHttpRequest.DONE||4)&&s.abort(),m!==null&&(clearTimeout(m),m=null),s=null};let S=L=>{let g=L.message||"Unknown error";o&&s?o(new F(g,s)):v.Error(g)},C=L=>{if(s){if(s.open("GET",a),u)try{u(s)}catch(g){S(g);return}c&&(s.responseType="arraybuffer"),t&&s.addEventListener("progress",t),b&&s.addEventListener("loadend",b),h=()=>{if(!(d||!s)&&s.readyState===(XMLHttpRequest.DONE||4)){if(h&&s.removeEventListener("readystatechange",h),s.status>=200&&s.status<300||s.status===0&&(!_()||te())){try{r&&r(c?s.response:s.responseText,s)}catch(l){S(l)}return}let g=x.DefaultRetryStrategy;if(g){let l=g(a,s,L);if(l!==-1){q(),s=new y,m=setTimeout(()=>C(L+1),l);return}}let j=new F("Error status: "+s.status+" "+s.statusText+" - Unable to load "+a,s);o&&o(j)}},s.addEventListener("readystatechange",h),s.send()}};C(0)};if(i&&i.enableSceneOffline){let s=h=>{h&&h.status>400?o&&o(h):n()},m=()=>{i&&i.loadFile(x.BaseUrl+e,h=>{!d&&r&&r(h),f.onCompleteObservable.notifyObservers(f)},t?h=>{!d&&t&&t(h)}:void 0,s,c)};i.open(m,s)}else n();return f},te=()=>typeof location<"u"&&location.protocol==="file:",ce=e=>Q.test(e),ue=e=>{let r=Q.exec(e);return r===null||r.length===0?{match:!1,type:""}:{match:!0,type:r[0].replace("data:","").replace("base64,","")}};function re(e){return J(e.split(",")[1])}var se=e=>A(e.split(",")[1]),de=()=>{P._FileToolsLoadImage=Z,$.loadFile=E,z.loadFile=E};de();var w,fe=(e,r,t,i,c,o,u,a,d,f)=>{w={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:r,DefaultRetryStrategy:t.DefaultRetryStrategy,BaseUrl:t.BaseUrl,CorsBehavior:t.CorsBehavior,PreprocessUrl:t.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:c,LoadFile:o,LoadImage:u,ReadFile:a,RequestFile:d,SetCorsBehavior:f},Object.defineProperty(w,"DefaultRetryStrategy",{get:function(){return t.DefaultRetryStrategy},set:function(n){t.DefaultRetryStrategy=n}}),Object.defineProperty(w,"BaseUrl",{get:function(){return t.BaseUrl},set:function(n){t.BaseUrl=n}}),Object.defineProperty(w,"PreprocessUrl",{get:function(){return t.PreprocessUrl},set:function(n){t.PreprocessUrl=n}}),Object.defineProperty(w,"CorsBehavior",{get:function(){return t.CorsBehavior},set:function(n){t.CorsBehavior=n}})};fe(re,se,x,ce,te,E,Z,W,ee,Y);export{y as a,H as b,U as c,V as d,T as e,me as f,be as g,x as h,Y as i,Z as j,W as k,E as l,ee as m,ce as n,re as o};
